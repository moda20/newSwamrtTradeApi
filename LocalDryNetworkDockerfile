FROM node:lts

ARG SOURCE_CHAIN_RPC_ENDPOINT
ARG ACCOUNT_TO_UNLOCK
ARG RPC_ENDPOINT_PORT=8545
ARG RPC_ENDPOINT_HOST=0.0.0.0
ARG CHAIN_BLOCK_GAS_LIMIT=80000000000

ENV SOURCE_CHAIN_RPC_ENDPOINT ${SOURCE_CHAIN_RPC_ENDPOINT}
ENV ACCOUNT_TO_UNLOCK ${ACCOUNT_TO_UNLOCK}
ENV RPC_ENDPOINT_PORT ${RPC_ENDPOINT_PORT}
ENV RPC_ENDPOINT_HOST ${RPC_ENDPOINT_HOST}
ENV CHAIN_BLOCK_GAS_LIMIT ${CHAIN_BLOCK_GAS_LIMIT}

RUN mkdir -p /home/app
WORKDIR /home/app
RUN npm install -g ganache-cli

CMD ganache-cli --fork $SOURCE_CHAIN_RPC_ENDPOINT -u $ACCOUNT_TO_UNLOCK -e 100000000 -p $RPC_ENDPOINT_PORT -h $RPC_ENDPOINT_HOST -l $CHAIN_BLOCK_GAS_LIMIT -d
